{"version":3,"sources":["../src/app.js"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["/* globals $, URLSearchParams, WebSocket, Audio, locales, Keyboard, Keypad, Jed, BigNumber, PORT, Origami, kjua */\n'use strict'\n\nconst queryString = window.location.search\nconst params = new URLSearchParams(queryString.substring(1))\nconst SCREEN = params.get('screen')\nconst DEBUG_MODE = SCREEN ? 'demo' : params.get('debug')\n\nconsole.log('DEBUG11')\nvar fiatCode = null\nvar locale = null\nvar localeCode = null\nvar jsLocaleCode = null  // Sometimes slightly different than localeCode\nvar _primaryLocales = []\nvar lastRates = null\nvar coins = {\n  BTC: {\n    unitScale: 8,\n    displayScale: 5,\n    displayCode: 'mBTC'\n  },\n  ETH: {\n    unitScale: 18,\n    displayScale: 15,\n    displayCode: 'mETH'\n  },\n  ZEC: {\n    unitScale: 8,\n    displayScale: 5,\n    displayCode: 'mZEC'\n  },\n  LTC: {\n    unitScale: 8,\n    displayScale: 5,\n    displayCode: 'mLTC'\n  },\n  DASH: {\n    unitScale: 8,\n    displayScale: 5,\n    displayCode: 'mDASH'\n  }\n}\n\nvar currentState\n\nvar confirmBeep = null\nvar accepting = false\nvar websocket = null\nvar wifiKeyboard = null\nvar phoneKeypad = null\nvar securityKeypad = null\nvar previousState = null\nvar onSendOnly = false\nvar buttonActive = true\nvar cassettes = null\nlet currentCryptoCode = null\n\nvar BRANDON = ['ca', 'cs', 'da', 'de', 'en', 'es', 'et', 'fi', 'fr', 'hr',\n  'hu', 'it', 'lt', 'nb', 'nl', 'pl', 'pt', 'ro', 'sl', 'sv', 'tr']\n\nfunction connect () {\n  websocket = new WebSocket('ws://localhost:' + PORT + '/')\n  websocket.onmessage = function (event) {\n    var data = $.parseJSON(event.data)\n    processData(data)\n  }\n}\n\nfunction verifyConnection () {\n  if (websocket.readyState === websocket.CLOSED) {\n    connect()\n  }\n}\n\nfunction buttonPressed (button, data) {\n  if (!buttonActive) return\n  wifiKeyboard.deactivate()\n  buttonActive = false\n  setTimeout(function () {\n    buttonActive = true\n    wifiKeyboard.activate()\n  }, 300)\n  var res = {button: button}\n  if (data || data === null) res.data = data\n  websocket.send(JSON.stringify(res))\n}\n\nfunction processData (data) {\n  console.log('DEBUG400: %j', data)\n  if (data.localeInfo) setLocaleInfo(data.localeInfo)\n  if (data.locale) setLocale(data.locale)\n  if (!locale) return\n  if (data.fiatCode) setFiatCode(data.fiatCode)\n  if (data.rates) setExchangeRate(data.rates)\n  if (data.buyerAddress) setBuyerAddress(data.buyerAddress)\n  if (data.credit) {\n    var lastBill = data.action === 'rejectedBill' ? null : data.credit.lastBill\n    setCredit(data.credit.fiat, data.credit.cryptoAtoms, lastBill, data.credit.cryptoCode)\n  }\n  if (data.txId) setTxId(data.txId)\n  if (data.wifiList) setWifiList(data.wifiList)\n  if (data.wifiSsid) setWifiSsid(data.wifiSsid)\n  if (data.sendOnly) sendOnly(data.reason, data.cryptoCode)\n  if (data.fiatCredit) fiatCredit(data.fiatCredit)\n  if (data.depositInfo) setDepositAddress(data.depositInfo, data.depositUrl)\n  if (data.cassettes) setupCassettes(data.cassettes)\n  if (data.beep) confirmBeep.play()\n  if (data.sent && data.total) setPartialSend(data.sent, data.total)\n  if (data.readingBill) readingBill(data.readingBill)\n  if (data.cryptoCode) translateCoin(data.cryptoCode)\n  if (data.tx && data.tx.cashInFee) setFixedFee(data.tx.cashInFee)\n\n  if (data.context) {\n    $('.js-context').hide()\n    $('.js-context-' + data.context).show()\n  }\n\n  switch (data.action) {\n    case 'wifiList':\n      setState('wifi')\n      break\n    case 'wifiPass':\n      setState('wifi_password')\n      break\n    case 'wifiConnecting':\n      t('wifi-connecting',\n        locale.translate('This could take a few moments.').fetch())\n      setState('wifi_connecting')\n      break\n    case 'wifiConnected':\n      t('wifi-connecting',\n        locale.translate('Connected. Waiting for ticker.').fetch())\n      setState('wifi_connecting')  // in case we didn't go through wifi-connecting\n      break\n    case 'pairing':\n      confirmBeep.play()\n      setState('pairing')\n      break\n    case 'pairingError':\n      $('.js-pairing-error').text(data.err)\n      // Give it some time to update text in background\n      setTimeout(function () { setState('pairing_error') }, 500)\n      break\n    case 'booting':\n      if (currentState !== 'maintenance') setState('booting')\n      break\n    case 'idle':\n    case 'fakeIdle':\n      setState('idle')\n      break\n    case 'dualIdle':\n    case 'fakeDualIdle':\n      setState('dual_idle')\n      break\n    case 'registerPhone':\n      phoneKeypad.activate()\n      setState('register_phone')\n      break\n    case 'registerCode':\n      securityKeypad.activate()\n      setState('security_code')\n      break\n    case 'scanned':\n      setState('insert_bills')\n      break\n    case 'acceptingFirstBill':\n      $('.js-send-crypto-disable').hide()\n      $('.js-send-crypto-enable').show()\n      setState('insert_bills')\n      break\n    case 'acceptingBills':\n      setState('insert_more_bills')\n      break\n    case 'acceptingBill':\n      setAccepting(true)\n      break\n    case 'rejectedBill':\n      setAccepting(false)\n      break\n    case 'cryptoTransferPending':\n      setState('sending_coins')\n      break\n    case 'cryptoTransferComplete':\n      confirmBeep.play()\n      setState('completed')\n      break\n    case 'networkDown':\n      setState('trouble')\n      break\n    case 'balanceLow':\n    case 'insufficientFunds':\n      setState('limit_reached')\n      break\n    case 'highBill':\n      highBill(data.highestBill, data.reason)\n      break\n    case 'minimumTx':\n      minimumTx(data.lowestBill)\n      break\n    case 'chooseFiat':\n      chooseFiat(data.chooseFiat)\n      break\n    case 'deposit':\n      setState('deposit')\n      deposit(data.tx)\n      break\n    case 'rejectedDeposit':\n      setState('deposit_timeout')\n      break\n    case 'fiatReceipt':\n      fiatReceipt(data.tx)\n      break\n    case 'fiatComplete':\n      fiatComplete(data.tx)\n      break\n    case 'restart':\n      setState('restart')\n      break\n    case 'chooseCoin':\n      chooseCoin(data.coins, data.twoWayMode)\n      break\n    case 'smsVerification':\n      smsVerification(data.threshold)\n      break\n    default:\n      if (data.action) setState(window.snakecase(data.action))\n  }\n}\n\nfunction smsVerification (threshold) {\n  console.log('sms threshold to be displayed', threshold)\n  setScreen('sms_verification')\n}\n\nfunction chooseCoin (coins, twoWayMode) {\n  if (twoWayMode) {\n    $('.choose_coin_state').removeClass('choose-coin-cash-in').addClass('choose-coin-two-way')\n  } else {\n    $('.choose_coin_state').removeClass('choose-coin-two-way').addClass('choose-coin-cash-in')\n  }\n\n  const defaultCoin = coins[0]\n\n  currentCryptoCode = defaultCoin.cryptoCode\n\n  const cashIn = $('.cash-in')\n  const cashOut = $('.cash-out')\n\n  cashIn.html(`Buy<br/>${defaultCoin.display}`)\n  cashOut.html(`Sell<br/>${defaultCoin.display}`)\n\n  $('.crypto-buttons').empty()\n\n  if (coins.length > 1) {\n    coins.forEach(function (coin) {\n      const activeClass = coin.cryptoCode === currentCryptoCode ? 'choose-coin-button-active' : ''\n      const el = `<div class=\"choose-coin-button coin-${coin.cryptoCode.toLowerCase()} ${activeClass}\" data-crypto-code=\"${coin.cryptoCode}\">${coin.display}</div>`\n      $('.crypto-buttons').append(el)\n    })\n  }\n\n  setState('choose_coin')\n}\n\nfunction switchCoin (coin) {\n  const cashIn = $('.cash-in')\n  const cashOut = $('.cash-out')\n  const cryptoCode = coin.cryptoCode\n\n  if (currentCryptoCode === cryptoCode) return\n\n  $(`.coin-${currentCryptoCode.toLowerCase()}`).removeClass('choose-coin-button-active')\n  $(`.coin-${cryptoCode.toLowerCase()}`).addClass('choose-coin-button-active')\n  currentCryptoCode = cryptoCode\n\n  cashIn.addClass('crypto-switch')\n  setTimeout(() => cashIn.html(`Buy<br/>${coin.display}`), 100)\n  setTimeout(() => cashIn.removeClass('crypto-switch'), 1000)\n\n  setTimeout(() => {\n    cashOut.addClass('crypto-switch')\n    setTimeout(() => cashOut.html(`Sell<br/>${coin.display}`), 100)\n    setTimeout(() => cashOut.removeClass('crypto-switch'), 1000)\n  }, 80)\n}\n\n$(document).ready(function () {\n  const attachFastClick = Origami.fastclick\n  attachFastClick(document.body)\n\n  // Matt's anti-drag hack\n  window.onclick =\n    window.oncontextmenu =\n      window.onmousedown =\n        window.onmousemove =\n          window.onmouseup =\n            function () { return false }\n\n  BigNumber.config({ROUNDING_MODE: BigNumber.ROUND_HALF_EVEN})\n\n  wifiKeyboard = new Keyboard('wifi-keyboard').init()\n\n  phoneKeypad = new Keypad('phone-keypad', {type: 'phoneNumber', country: 'US'}, function (result) {\n    if (currentState !== 'register_phone') return\n    console.log('phoneKeypad: %s', result)\n    buttonPressed('phoneNumber', result)\n  })\n\n  securityKeypad = new Keypad('security-keypad', {type: 'code'}, function (result) {\n    if (currentState !== 'security_code') return\n    console.log(result)\n    buttonPressed('securityCode', result)\n  })\n\n  // buffers automatically when created\n  confirmBeep = new Audio('sounds/Confirm8-Bit.ogg')\n\n  if (DEBUG_MODE !== 'demo') {\n    connect()\n    setInterval(verifyConnection, 1000)\n  }\n\n  initTranslatePage()\n\n  var wifiNetworkButtons = document.getElementById('networks')\n  touchEvent(wifiNetworkButtons, function (e) {\n    var target = $(e.target)\n    if (target.attr('id') === 'more-networks') {\n      moreNetworks()\n    } else {\n      var networkButton = target.closest('.wifi-network-button')\n      $('#networks > .active').removeClass('active')\n      networkButton.addClass('active')\n      window.setTimeout(function () { networkButton.removeClass('active') }, 1000)\n      var ssidEl = networkButton.find('.ssid')\n      var ssid = ssidEl.data('ssid')\n      if (ssid) {\n        var displaySsid = ssidEl.text()\n        var rawSsid = ssidEl.data('raw-ssid')\n        buttonPressed('wifiSelect',\n          {ssid: ssid, rawSsid: rawSsid, displaySsid: displaySsid})\n      }\n    }\n  })\n\n  var wifiConnectButton = document.getElementById('wifiConnect')\n  touchEvent(wifiConnectButton, function () {\n    var wifiConnectButtonJ = $(wifiConnectButton)\n    wifiConnectButtonJ.addClass('active')\n    window.setTimeout(function () { wifiConnectButtonJ.removeClass('active') }, 500)\n    var pass = $('#wifi-keyboard input.passphrase').data('content')\n    var ssid = $('#js-i18n-wifi-for-ssid').data('ssid')\n    var rawSsid = $('#js-i18n-wifi-for-ssid').data('raw-ssid')\n    buttonPressed('wifiConnect', {pass: pass, ssid: ssid, rawSsid: rawSsid})\n  })\n\n  var sendCoinsButton = document.getElementById('send-coins')\n  touchEvent(sendCoinsButton, function () {\n    setState('sending_coins')\n    buttonPressed('sendCoins')\n  })\n\n  // TODO: add this to setupButton\n  const sendCoinsButtonSms = document.getElementById('send-coins-sms')\n  touchEvent(sendCoinsButtonSms, function () {\n    /**\n     * Don't set a screen here.\n     *\n     * Machine will decided which screent to set.\n     * It depends from the transaction's fiat amount inserted\n     * If the user has zero bills inserted machine will show\n     * the \"chooseCoin\" screen, else the sendCoins screen\n     */\n    buttonPressed('finishBeforeSms')\n  })\n\n  // TODO: add this to setupButton\n  var smsCompliance = document.getElementById('sms-start-verification')\n  touchEvent(smsCompliance, function () {\n    buttonPressed('smsCompliance')\n  })\n\n  var insertBillCancelButton = document.getElementById('insertBillCancel')\n  touchImmediateEvent(insertBillCancelButton, function () {\n    setBuyerAddress(null)\n    buttonPressed('cancelInsertBill')\n  })\n\n  setupImmediateButton('wifiPassCancel', 'cancelWifiPass')\n  setupImmediateButton('wifiListCancel', 'cancelWifiList')\n  setupImmediateButton('scanCancel', 'cancelScan')\n  setupImmediateButton('completed_viewport', 'completed')\n  setupImmediateButton('withdraw_failure_viewport', 'completed')\n  setupImmediateButton('fiat_receipt_viewport', 'completed')\n  setupImmediateButton('fiat_complete_viewport', 'completed')\n  setupImmediateButton('chooseFiatCancel', 'chooseFiatCancel')\n  setupImmediateButton('depositCancel', 'depositCancel')\n\n  setupButton('initialize', 'initialize')\n  setupButton('test-mode', 'testMode')\n  setupButton('pairing-scan', 'pairingScan')\n  setupButton('pairing-scan-cancel', 'pairingScanCancel')\n  setupButton('pairing-error-ok', 'pairingScanCancel')\n  setupButton('cash-out-button', 'cashOut')\n\n  // var button = document.getElementById('js-coin-selection')\n  // touchEvent(button, function (e) {\n  //   var cryptoCode = e.target.dataset.coin\n  //   buttonPressed('chooseCoin', cryptoCode)\n  // })\n\n  setupImmediateButton('scan-id-cancel', 'cancelIdScan')\n  setupImmediateButton('phone-number-cancel', 'cancelPhoneNumber',\n    phoneKeypad.deactivate.bind(phoneKeypad))\n  setupImmediateButton('security-code-cancel', 'cancelSecurityCode',\n    securityKeypad.deactivate.bind(securityKeypad))\n  setupButton('id-verification-failed-ok', 'idVerificationFailedOk')\n  setupButton('id-code-failed-retry', 'idCodeFailedRetry')\n  setupButton('id-code-failed-cancel', 'idCodeFailedCancel')\n  setupButton('id-verification-error-ok', 'idVerificationErrorOk')\n\n  setupButton('limit-reached-ok', 'idle')\n  setupButton('deposit-timeout-sent-yes', 'depositTimeout')\n  setupButton('deposit-timeout-sent-no', 'depositTimeoutNotSent')\n  setupButton('out-of-cash-ok', 'idle')\n\n  setupButton('bad-phone-number-ok', 'badPhoneNumberOk')\n  setupButton('bad-security-code-ok', 'badSecurityCodeOk')\n  setupButton('max-phone-retries-ok', 'maxPhoneRetriesOk')\n  setupButton('redeem-later-ok', 'idle')\n  setupButton('pre-receipt-ok', 'fiatReceipt')\n  setupButton('fiat-error-ok', 'idle')\n  setupButton('network-down-ok', 'idle')\n  setupButton('fiat-transaction-error-ok', 'fiatReceipt')\n\n  setupButton('unknown-phone-number-ok', 'idle')\n  setupButton('unconfirmed-deposit-ok', 'idle')\n  setupButton('wrong-dispenser-currency-ok', 'idle')\n\n  $('.crypto-buttons').click(event => {\n    const el = $(event.target)\n    const coin = {cryptoCode: el.data('cryptoCode'), display: el.text()}\n    switchCoin(coin)\n  })\n\n  $('.coin-redeem-button').click(() => buttonPressed('redeem'))\n\n  const cashInBox = $('.cash-in-box')\n  cashInBox.click(() => {\n    cashInBox.addClass('switch-screen')\n\n    setTimeout(() => buttonPressed('start', {cryptoCode: currentCryptoCode, direction: 'cashIn'}), 600)\n\n    setTimeout(() => {\n      cashInBox.removeClass('switch-screen')\n    }, 1000)\n  })\n\n  const cashOutBox = $('.cash-out-box')\n  cashOutBox.click(() => {\n    cashOutBox.addClass('switch-screen')\n\n    setTimeout(() => buttonPressed('start', {cryptoCode: currentCryptoCode, direction: 'cashOut'}), 600)\n\n    setTimeout(() => {\n      cashOutBox.removeClass('switch-screen')\n    }, 1000)\n  })\n\n  var lastTouch = null\n\n  var languageButtons = document.getElementById('languages')\n  touchEvent(languageButtons, function (e) {\n    var languageButtonJ = $(e.target).closest('li')\n    if (languageButtonJ.length === 0) return\n    var newLocale = languageButtonJ.attr('data-locale')\n    buttonPressed('setLocale', {locale: newLocale})\n  })\n\n  var fiatButtons = document.getElementById('js-fiat-buttons')\n  touchImmediateEvent(fiatButtons, function (e) {\n    var now = Date.now()\n    if (lastTouch && now - lastTouch < 100) return\n    lastTouch = now\n    var cashButtonJ = $(e.target).closest('.cash-button')\n    if (cashButtonJ.length === 0) return\n    if (cashButtonJ.hasClass('disabled')) return\n    if (cashButtonJ.hasClass('clear')) return buttonPressed('clearFiat')\n    var denominationIndex = cashButtonJ.attr('data-denomination-index')\n    var denominationRec = cassettes[denominationIndex]\n    buttonPressed('fiatButton', {denomination: denominationRec.denomination})\n  })\n\n  initDebug()\n})\n\nfunction targetButton (element) {\n  var classList = element.classList\n  var special = classList.contains('button') ||\n    classList.contains('circle-button') ||\n    classList.contains('wifi-network-button') ||\n    classList.contains('square-button')\n  if (special) { return element }\n  return targetButton(element.parentNode)\n}\n\nfunction touchEvent (element, callback) {\n  element.addEventListener('mousedown', function (e) {\n    var target = targetButton(e.target)\n    target.classList.add('active')\n\n    // Wait for transition to finish\n    setTimeout(function () {\n      target.classList.remove('active')\n    }, 300)\n\n    setTimeout(function () {\n      callback(e)\n    }, 200)\n\n    e.stopPropagation()\n    e.preventDefault()\n  })\n}\n\nfunction touchImmediateEvent (element, callback) {\n  element.addEventListener('mousedown', function (e) {\n    callback(e)\n    e.stopPropagation()\n    e.preventDefault()\n  })\n}\n\nfunction setupImmediateButton (buttonClass, buttonAction, callback) {\n  var button = document.getElementById(buttonClass)\n  touchImmediateEvent(button, function () {\n    if (callback) callback()\n    buttonPressed(buttonAction)\n  })\n}\n\nfunction setupButton (buttonClass, buttonAction) {\n  var button = document.getElementById(buttonClass)\n  touchEvent(button, function () {\n    buttonPressed(buttonAction)\n  })\n}\n\nfunction setScreen (newScreen, oldScreen) {\n  if (newScreen === oldScreen) return\n\n  if (newScreen === 'insert_bills') {\n    $('.js-processing-bill').html(locale.translate('Lamassu Cryptomat').fetch())\n    $('.bill img').css({'-webkit-transform': 'none', top: 0, left: 0})\n  }\n\n  var newView = $('.' + newScreen + '_state')\n\n  $('.viewport').removeClass('viewport-active')\n  newView.addClass('viewport-active')\n}\n\nfunction setState (state, delay) {\n  if (state === currentState) return\n\n  onSendOnly = false\n\n  previousState = currentState\n  currentState = state\n\n  wifiKeyboard.reset()\n\n  if (state === 'idle') {\n    $('.qr-code').empty()\n    $('.qr-code-deposit').empty()\n  }\n\n  if (delay) {\n    window.setTimeout(function () {\n      setScreen(currentState, previousState)\n    }, delay)\n  } else setScreen(currentState, previousState)\n\n  if (state === 'insert_more_bills') {\n    $('#limit-reached-section').css({'display': 'none'})\n    $('#insert-another').css({'display': 'block'})\n    t('or', locale.translate('OR').fetch())\n    $('.or-circle circle').attr('r', $('#js-i18n-or').width() / 2 + 15)\n  }\n}\n\nfunction revertScreen () { setScreen(currentState) }\n\nfunction setWifiList (recs, requestedPage) {\n  var networks = $('#networks')\n  if (!recs) recs = networks.data('recs')\n  var page = requestedPage || networks.data('page') || 0\n  var offset = page * 4\n  if (offset > recs.length - 1) {\n    offset = 0\n    page = 0\n  }\n  $('#more-networks').css({'display': 'none'})\n  networks.empty()\n  networks.data('page', page)\n  networks.data('recs', recs)\n  var remainingCount = recs.length - offset\n  var len = Math.min(remainingCount, 4)\n  for (var i = 0; i < len; i++) {\n    var rec = recs[i + offset]\n    var bars = 'bar' + (Math.floor(rec.strength * 4) + 1)\n    var html = '<div class=\"wifi-network-button\">' +\n    '<span class=\"ssid\" data-raw-ssid=\"' + rec.rawSsid + '\" data-ssid=\"' +\n      rec.ssid + '\">' + rec.displaySsid +\n    '</span>' + '<span class=\"icon ' + bars + '\"></span></div>'\n    networks.append(html)\n  }\n  var moreTxt = locale.translate('MORE').fetch()\n  var button = '<span display=\"inline-block\" id=\"more-networks\" class=\"button\">' + moreTxt + '</span>'\n  if (recs.length > 4) {\n    networks.append(button)\n  }\n}\n\nfunction moreNetworks () {\n  var networks = $('#networks')\n  var page = networks.data('page')\n  setWifiList(null, page + 1)\n}\n\nfunction setWifiSsid (data) {\n  $('#js-i18n-wifi-for-ssid').data('ssid', data.ssid)\n  $('#js-i18n-wifi-for-ssid').data('raw-ssid', data.rawSsid)\n  t('wifi-for-ssid', locale.translate('for %s')\n    .fetch('<strong>' + data.ssid + '</strong>'))\n  t('wifi-connect', locale.translate(\"You're connecting to the WiFi network %s\")\n    .fetch('<strong>' + data.ssid + '</strong>'))\n}\n\nfunction setLocaleInfo (data) {\n  phoneKeypad.setCountry(data.country)\n  setPrimaryLocales(data.primaryLocales)\n  setLocale(data.primaryLocale)\n}\n\nfunction setLocale (data) {\n  if (!data || data === localeCode) return\n  localeCode = data\n  jsLocaleCode = data\n  var lang = localeCode.split('-')[0]\n\n  if (jsLocaleCode === 'fr-QC') jsLocaleCode = 'fr-CA'\n\n  var isArabic = jsLocaleCode.indexOf('ar-') === 0\n  var isHebrew = jsLocaleCode.indexOf('he-') === 0\n  var isRTL = isArabic || isHebrew\n\n  if (isRTL) {\n    $('body').addClass('i18n-rtl')\n  } else {\n    $('body').removeClass('i18n-rtl')\n  }\n\n  if (isArabic) {\n    $('body').addClass('i18n-ar')\n  } else {\n    $('body').removeClass('i18n-ar')\n  }\n\n  if (isHebrew) {\n    $('body').addClass('i18n-he')\n  } else {\n    $('body').removeClass('i18n-he')\n  }\n\n  if (BRANDON.indexOf(lang) !== -1) $('body').addClass('brandon')\n  else $('body').removeClass('brandon')\n\n  locale = loadI18n(localeCode)\n  try { translatePage() } catch (ex) {}\n  if (lastRates) setExchangeRate(lastRates)\n}\n\nfunction areArraysEqual (arr1, arr2) {\n  if (arr1.length !== arr2.length) return false\n  for (var i = 0; i < arr1.length; i++) {\n    if (arr1[i] !== arr2[i]) return false\n  }\n  return true\n}\n\nfunction lookupLocaleNames (locale) {\n  var langMap = window.languageMappingList\n  var language = locale.split('-')[0]\n  var localeNames = langMap[language]\n  return localeNames || langMap[locale]\n}\n\nfunction setPrimaryLocales (primaryLocales) {\n  if (areArraysEqual(primaryLocales, _primaryLocales)) return\n  _primaryLocales = primaryLocales\n\n  var languages = $('.languages')\n  languages.empty()\n  var sortedPrimaryLocales = primaryLocales.filter(lookupLocaleNames).sort(function (a, b) {\n    var langA = lookupLocaleNames(a)\n    var langB = lookupLocaleNames(b)\n    return langA.englishName.localeCompare(langB.englishName)\n  })\n\n  for (var i = 0; i < sortedPrimaryLocales.length; i++) {\n    var l = sortedPrimaryLocales[i]\n    var lang = lookupLocaleNames(l)\n    var englishName = lang.englishName\n    var nativeName = lang.nativeName\n    var li = nativeName === englishName\n    ? '<li class=\"square-button\" data-locale=\"' + l + '\">' + englishName + '</li>'\n    : '<li class=\"square-button\" data-locale=\"' + l + '\">' + englishName +\n      '<span class=\"native\">' + nativeName + '</span> </li>'\n    languages.append(li)\n  }\n\n  if (primaryLocales.length === 1) $('.change-language-button').hide()\n  else $('.change-language-button').show()\n\n  if (primaryLocales.length === 2) languages.addClass('n2')\n  else languages.removeClass('n2')\n}\n\nfunction setFiatCode (data) {\n  fiatCode = data\n  $('.js-currency').text(fiatCode)\n}\n\nfunction setFixedFee (_fee) {\n  const fee = parseFloat(_fee)\n\n  if (fee > 0) {\n    const fixedFee = '<strong>+</strong>' + locale.translate('%s transaction fee').fetch(formatFiat(fee, 2))\n    $('.js-i18n-fixed-fee').html(fixedFee)\n  } else {\n    $('.js-i18n-fixed-fee').html('')\n  }\n}\n\nfunction setCredit (fiat, crypto, lastBill, cryptoCode) {\n  var coin = coins[cryptoCode]\n\n  $('.total-deposit').html(formatFiat(fiat))\n  var scale = new BigNumber(10).pow(coin.displayScale)\n  var cryptoAmount = new BigNumber(crypto).div(scale).toNumber()\n  var cryptoDisplayCode = coin.displayCode\n  updateCrypto('.total-crypto-rec', cryptoAmount, cryptoDisplayCode)\n\n  var inserted = lastBill\n  ? locale.translate('You inserted a %s bill').fetch(formatFiat(lastBill))\n  : locale.translate('Lamassu Cryptomat').fetch()\n\n  $('.js-processing-bill').html(inserted)\n\n  $('.js-send-crypto-disable').hide()\n  $('.js-send-crypto-enable').show()\n}\n\nfunction setupCassettes (_cassettes) {\n  cassettes = _cassettes\n  for (var i = 0; i < cassettes.length; i++) {\n    var cassette = cassettes[i]\n    var denomination = cassette.denomination.toLocaleString(jsLocaleCode, {\n      useGrouping: true,\n      maximumFractionDigits: 0,\n      minimumFractionDigits: 0\n    })\n    $('.cash-button[data-denomination-index=' + i + '] .js-denomination').text(denomination)\n  }\n}\n\nfunction updateCrypto (selector, cryptoAmount, cryptoDisplayCode) {\n  $(selector).find('.crypto-amount').html(formatCrypto(cryptoAmount))\n  $(selector).find('.crypto-units').html(cryptoDisplayCode)\n}\n\nfunction lookupDecimalChar (localeCode) {\n  var num = 1.1\n  var localized = num.toLocaleString(jsLocaleCode, {\n    useGrouping: true,\n    maximumFractionDigits: 1,\n    minimumFractionDigits: 1\n  })\n\n  return localized[1]\n}\n\nfunction splitNumber (localize, localeCode) {\n  var decimalChar = lookupDecimalChar(localeCode)\n  var split = localize.split(decimalChar)\n\n  if (split.length === 1) {\n    return ['<span class=\"integer\">', split[0], '</span>'].join('')\n  }\n\n  return [\n    '<span class=\"integer\">', split[0], '</span><span class=\"decimal-char\">',\n    decimalChar, '</span><span class=\"decimal\">', split[1], '</span>'\n  ].join('')\n}\n\nfunction formatNumber (num) {\n  var localized = num.toLocaleString(jsLocaleCode, {\n    useGrouping: true,\n    maximumFractionDigits: 3,\n    minimumFractionDigits: 3\n  })\n\n  return splitNumber(localized, jsLocaleCode)\n}\n\nfunction formatCrypto (amount) {\n  return formatNumber(amount)\n}\n\nfunction formatFiat (amount, fractionDigits) {\n  if (!fractionDigits) fractionDigits = 0\n  var localized = null\n  var _localized = null\n\n  switch (fiatCode + ':' + jsLocaleCode) {\n    case 'DKK:en-US':\n    case 'SEK:en-US':\n      _localized = amount.toLocaleString(jsLocaleCode, {\n        useGrouping: true,\n        maximumFractionDigits: fractionDigits,\n        minimumFractionDigits: fractionDigits\n      })\n      localized = splitNumber(_localized, jsLocaleCode) + fiatCode\n      break\n    default:\n      _localized = amount.toLocaleString(jsLocaleCode, {\n        style: 'currency',\n        currency: fiatCode,\n        currencyDisplay: 'symbol',\n        useGrouping: true,\n        maximumFractionDigits: fractionDigits,\n        minimumFractionDigits: fractionDigits\n      })\n      localized = splitNumber(_localized, jsLocaleCode)\n      break\n  }\n\n  return localized\n}\n\nfunction singleCurrencyUnit () {\n  return formatFiat(1)\n}\n\nfunction setExchangeRate (_rates) {\n  lastRates = _rates\n  var cryptoCode = _rates.cryptoCode\n  var rates = _rates.rates\n\n  var coin = coins[cryptoCode]\n  var displayCode = coin.displayCode\n  var coinDisplayFactor = new BigNumber(10).pow(coin.unitScale - coin.displayScale)\n\n  var cryptoToFiat = new BigNumber(rates.cashIn)\n\n  var fiatToCrypto = new BigNumber(1).div(cryptoToFiat.div(coinDisplayFactor)).round(3).toString()\n\n  var rateStr = formatFiat(cryptoToFiat.round(2).toNumber(), 2)\n  var translated = locale.translate('Our current %s price is %s').fetch(cryptoCode, rateStr)\n  $('.js-i18n-current-crypto-price').html(translated)\n  updateCrypto('.reverse-exchange-rate', fiatToCrypto, displayCode)\n  var insertedText = locale.translate('per %s inserted')\n    .fetch(singleCurrencyUnit())\n  $('#fiat-inserted').html(insertedText)\n\n  if (rates.cashOut) {\n    var cashOut = new BigNumber(rates.cashOut)\n    var cashOutCryptoToFiat = cashOut && formatCrypto(cashOut.round(3).toNumber())\n\n    var localizedCashOutCryptoToFiat =\n      locale.translate('1 %s is %s %s').fetch(cryptoCode, cashOutCryptoToFiat, fiatCode)\n    $('.js-fiat-crypto-rate').html(localizedCashOutCryptoToFiat)\n  }\n\n  $('.js-crypto-display-units').text(displayCode)\n}\n\nfunction qrize (text, target, size) {\n  const el = kjua({\n    text,\n    size,\n    render: 'canvas',\n    rounded: 50,\n    quiet: 1\n  })\n\n  target.empty().append(el)\n}\n\nfunction setTxId (txId) {\n  qrize(txId, $('#cash-in-qr-code'), 300)\n  qrize(txId, $('#cash-in-fail-qr-code'), 300)\n}\n\nfunction setBuyerAddress (address) {\n  $('.crypto-address').html(address)\n}\n\nfunction setAccepting (currentAccepting) {\n  accepting = currentAccepting\n  if (accepting) {\n    $('.bill img').transition({x: 0, y: -303}, 1000, 'ease-in')\n  } else {\n    $('.bill img').transition({x: 0, y: 0}, 1000, 'ease-out')\n  }\n}\n\nfunction highBill (highestBill, reason) {\n  var reasonText = reason === 'transactionLimit' ? 'Transaction limit reached.' : \"We're a little low.\"\n  t('high-bill-header', locale.translate(reasonText).fetch())\n  t('highest-bill', locale.translate('Please insert %s or less.')\n    .fetch(formatFiat(highestBill)))\n  setScreen('high_bill')\n  window.setTimeout(revertScreen, 3000)\n}\n\nfunction minimumTx (lowestBill) {\n  t('lowest-bill', locale.translate('Please insert %s or more.')\n    .fetch(formatFiat(lowestBill)))\n  setScreen('minimum_tx')\n  window.setTimeout(revertScreen, 3000)\n}\n\nfunction readingBill (bill) {\n  $('.js-processing-bill').html('Processing ' + formatFiat(bill) + '...')\n  $('.js-send-crypto-enable').hide()\n  $('.js-send-crypto-disable').show()\n}\n\nfunction sendOnly (reason, cryptoCode) {\n  // TODO: sendOnly should be made into its own state.\n  // Remove all instances of onSendOnly when doing this.\n  if (onSendOnly) return\n  onSendOnly = true\n\n  t('or', '!')\n  $('.or-circle circle').attr('r', $('#js-i18n-or').width() / 2 + 15)\n  const errorMessages = {\n    'transactionLimit': 'Transaction limit reached.',\n    'validatorError': 'Error in validation.',\n    'networkDown': 'Network connection error',\n    'lowBalance': \"We're out of %s\"\n  }\n  // If no reason provided defaults to lowBalance\n  const reasonText = errorMessages[reason] || errorMessages.lowBalance\n\n  console.log('DEBUG111: %s, %s', reason, reasonText)\n  t('limit-reached', locale.translate(reasonText).fetch(cryptoCode))\n  t('limit-description',\n    locale.translate('Please touch <strong>Send Coins</strong> to complete your purchase.').fetch())\n  $('#insert-another').css({'display': 'none'})\n  $('#limit-reached-section').css({'display': 'block'})\n}\n\nfunction setPartialSend (sent, total) {\n  $('#already-sent').text(formatFiat(sent.fiat))\n  $('#pending-sent').text(formatFiat(total.fiat - sent.fiat))\n}\n\nfunction t (id, str) {\n  $('#js-i18n-' + id).html(str)\n}\n\nfunction tc (className, str, cryptoCode) {\n  $('.js-i18n-' + className).html(locale.translate(str).fetch(cryptoCode))\n}\n\nfunction translateCoin (cryptoCode) {\n  tc('total-purchased', 'total %s purchased', cryptoCode)\n  tc('please-scan', 'Please scan the QR code to send us your %s.', cryptoCode)\n  tc('did-send-coins', 'Have you sent the %s yet?', cryptoCode)\n  tc('scan-address', 'Scan your %s address', cryptoCode)\n  tc('coins-to-address', 'Your %s will be sent to:', cryptoCode)\n\n  if (cryptoCode === 'ETH') {\n    tc('authorizing-note', 'This should take <strong>15 seconds</strong> on average.<br/>Occasionally, it will take over a minute.')\n  }\n}\n\nfunction initTranslatePage () {\n  $('.js-i18n').each(function () {\n    var el = $(this)\n    el.data('baseTranslation', el.html().trim())\n  })\n  $('input[placeholder]').each(function () {\n    var el = $(this)\n    el.data('baseTranslation', el.attr('placeholder'))\n  })\n}\n\nfunction translatePage () {\n  $('.js-i18n').each(function () {\n    var el = $(this)\n    var base = el.data('baseTranslation')\n    el.html(locale.translate(base).fetch())\n  })\n  $('input[placeholder]').each(function () {\n    var el = $(this)\n    var base = el.data('baseTranslation')\n    el.attr('placeholder', locale.translate(base).fetch())\n  })\n\n  // Adjust send coins button\n  var length = $('#send-coins span').text().length\n  if (length > 17) $('body').addClass('i18n-long-send-coins')\n  else $('body').removeClass('i18n-long-send-coins')\n}\n\nfunction loadI18n (localeCode) {\n  var messages = locales[localeCode] || locales['en-US']\n\n  return new Jed({\n    'missing_key_callback': function () {},\n    'locale_data': {\n      'messages': messages\n    }\n  })\n}\n\nfunction reachFiatLimit (rec) {\n  var msg = null\n  if (rec.isEmpty) msg = \"We're a little low, please cash out\"\n  else if (rec.txLimitReached) msg = 'Transaction limit reached, please cash out'\n\n  var el = $('.choose_fiat_state .limit')\n  if (msg) el.html(msg).show()\n  else el.hide()\n}\n\nfunction chooseFiat (data) {\n  fiatCredit(data)\n  setState('choose_fiat')\n}\n\nfunction manageFiatButtons (activeDenominations) {\n  for (var i = 0; i < cassettes.length; i++) {\n    var cassette = cassettes[i]\n    var denomination = cassette.denomination\n    var enabled = activeDenominations[denomination]\n    var button = $('.choose_fiat_state .cash-button[data-denomination-index=' + i + ']')\n    if (enabled) button.removeClass('disabled')\n    else button.addClass('disabled')\n  }\n}\n\nfunction displayCrypto (cryptoAtoms, cryptoCode) {\n  var coin = coins[cryptoCode]\n  var scale = new BigNumber(10).pow(coin.displayScale)\n  var cryptoAmount = new BigNumber(cryptoAtoms).div(scale).round(3).toNumber()\n  var cryptoDisplay = formatCrypto(cryptoAmount)\n\n  return cryptoDisplay\n}\n\nfunction BN (s) { return new BigNumber(s) }\n\nfunction fiatCredit (data) {\n  var tx = data.tx\n  var cryptoCode = tx.cryptoCode\n  var activeDenominations = data.activeDenominations\n  var coin = coins[cryptoCode]\n  const fiat = BN(tx.fiat)\n\n  var fiatDisplay = BN(tx.fiat).toNumber().toLocaleString(jsLocaleCode, {\n    useGrouping: true,\n    maximumFractionDigits: 0,\n    minimumFractionDigits: 0\n  })\n\n  var cryptoAtoms = BN(tx.cryptoAtoms)\n  var cryptoDisplay = displayCrypto(cryptoAtoms, cryptoCode)\n\n  var cryptoDisplayCode = coin.displayCode\n\n  if (cryptoAtoms.eq(0)) $('#js-i18n-choose-digital-amount').hide()\n  else $('#js-i18n-choose-digital-amount').show()\n\n  if (fiat.eq(0)) $('#cash-out-button').hide()\n  else $('#cash-out-button').show()\n\n  manageFiatButtons(activeDenominations.activeMap)\n  $('.choose_fiat_state .fiat-amount').text(fiatDisplay)\n  t('choose-digital-amount',\n    locale.translate(\"You'll be sending %s %s\").fetch(cryptoDisplay, cryptoDisplayCode))\n\n  reachFiatLimit(activeDenominations)\n}\n\nfunction setDepositAddress (tx, url) {\n  console.log('DEBUG22: %s', [tx, url])\n  $('.deposit_state .loading').hide()\n  $('.deposit_state .send-notice .crypto-address').text(tx.toAddress)\n  $('.deposit_state .send-notice').show()\n\n  qrize(url, $('#qr-code-deposit'), 330)\n}\n\nfunction deposit (tx) {\n  var cryptoCode = tx.cryptoCode\n  var display = displayCrypto(tx.cryptoAtoms, cryptoCode)\n\n  console.log('DEBUG88')\n  console.log('DEBUG89: %s', display)\n\n  $('.deposit_state .digital .js-amount').html(display)\n  $('.deposit_state .fiat .js-amount').text(tx.fiat)\n  $('.deposit_state .send-notice').hide()\n  $('#qr-code-deposit').empty()\n  $('.deposit_state .loading').show()\n\n  setState('deposit')\n}\n\nfunction fiatReceipt (tx) {\n  var cryptoCode = tx.cryptoCode\n  var display = displayCrypto(tx.cryptoAtoms, cryptoCode)\n\n  console.log('DEBUG99: %s', display)\n  $('.fiat_receipt_state .digital .js-amount').html(display)\n  $('.fiat_receipt_state .fiat .js-amount').text(tx.fiat)\n  $('.fiat_receipt_state .sent-coins .crypto-address').text(tx.toAddress)\n\n  qrize(tx.sessionId, $('#qr-code-fiat-receipt'), 330)\n  setState('fiat_receipt')\n}\n\nfunction fiatComplete (tx) {\n  var cryptoCode = tx.cryptoCode\n  var display = displayCrypto(tx.cryptoAtoms, cryptoCode)\n\n  console.log('DEBUG78')\n  console.log('DEBUG79: %s', display)\n\n  $('.fiat_complete_state .digital .js-amount').html(display)\n  $('.fiat_complete_state .fiat .js-amount').text(tx.fiat)\n  $('.fiat_complete_state .sent-coins .crypto-address').text(tx.toAddress)\n\n  qrize(tx.sessionId, $('#qr-code-fiat-complete'), 330)\n\n  setState('fiat_complete')\n}\n\nfunction initDebug () {\n  if (DEBUG_MODE === 'dev') {\n    $('body').css('cursor', 'default')\n    return\n  }\n\n  if (DEBUG_MODE === 'demo') {\n    setLocale('en-US')\n    $('body').css('cursor', 'default')\n\n    if (!SCREEN) {\n      return chooseCoin([\n        {display: 'Bitcoin', cryptoCode: 'BTC'},\n        {display: 'Ethereum', cryptoCode: 'ETH'},\n        {display: 'ZCash', cryptoCode: 'ZEC'}\n      ], true)\n    }\n\n    setState(SCREEN)\n  }\n}\n"]}